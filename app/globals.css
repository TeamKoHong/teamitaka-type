@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --brand: #F76241;
  --bg: #403E3E;
  --text: #FFFFFF;
  --muted: #B5B5B8;
  --elev: rgba(0,0,0,0.25);
}

/* Pretendard 폰트 로딩 */
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');

@layer base {
  html {
    font-display: swap;
    scroll-behavior: smooth;
  }

  body {
    font-family: 'Pretendard', 'Noto Sans KR', system-ui, sans-serif;
    background-color: var(--bg);
    color: var(--text);
  }

  /* Pull to refresh 색상 설정 - 강화된 버전 */
  html {
    background-color: var(--bg) !important;
    background: var(--bg) !important;
  }

  body {
    background-color: var(--bg) !important;
    background: var(--bg) !important;
  }

  /* iOS Safari Pull to refresh 색상 - 더 강력한 설정 */
  @supports (-webkit-touch-callout: none) {
    html {
      background-color: var(--bg) !important;
      background: var(--bg) !important;
    }
    
    body {
      background-color: var(--bg) !important;
      background: var(--bg) !important;
      -webkit-overflow-scrolling: touch;
    }
    
    /* iOS Safari 전용 추가 설정 */
    * {
      background-color: inherit;
    }
  }

  /* Android Chrome Pull to refresh 색상 - 더 강력한 설정 */
  @media screen and (max-width: 768px) {
    html {
      background-color: var(--bg) !important;
      background: var(--bg) !important;
    }
    
    body {
      background-color: var(--bg) !important;
      background: var(--bg) !important;
    }
    
    /* Android Chrome 전용 추가 설정 */
    * {
      background-color: inherit;
    }
  }

  /* 모든 모바일 브라우저에 대한 강제 설정 */
  @media (max-width: 768px) {
    html, body, #__next, main, div[class*="min-h-screen"] {
      background-color: var(--bg) !important;
      background: var(--bg) !important;
    }
  }

  /* Pull to refresh 전용 강제 설정 */
  @media (max-width: 768px) {
    /* 모든 가능한 컨테이너 요소들 */
    html, body, #__next, main, div, section, article {
      background-color: #403E3E !important;
      background: #403E3E !important;
    }
    
    /* Next.js 특화 설정 */
    [data-nextjs-scroll-focus-boundary] {
      background-color: #403E3E !important;
      background: #403E3E !important;
    }
    
    /* 뷰포트 전체 덮기 */
    * {
      background-color: inherit !important;
    }
  }

  /* iOS Safari 전용 추가 강제 설정 */
  @supports (-webkit-touch-callout: none) {
    @media (max-width: 768px) {
      html, body {
        background-color: #403E3E !important;
        background: #403E3E !important;
        -webkit-background-size: cover !important;
        background-size: cover !important;
      }
    }
  }

  @supports (padding: env(safe-area-inset-top)) {
    .safe-top {
      padding-top: env(safe-area-inset-top);
    }
    .safe-bottom {
      padding-bottom: env(safe-area-inset-bottom);
    }
  }

  /* 접근성 개선 */
  *:focus-visible {
    outline: 2px solid theme('colors.primary');
    outline-offset: 2px;
  }

  /* 터치 대상 최소 크기 */
  button, a, input, textarea, select {
    min-height: 44px;
    min-width: 44px;
  }
}

@layer utilities {
  /* 반응형 폰트 크기 유틸리티 */
  .text-responsive-question {
    font-size: clamp(16px, calc(20px * (100vw / 390px)), 24px);
  }
  
  .text-responsive-header {
    font-size: clamp(14px, calc(16px * (100vw / 390px)), 20px);
  }
  
  .text-responsive-button {
    font-size: clamp(16px, calc(18px * (100vw / 390px)), 22px);
  }
  
  .text-responsive-small {
    font-size: clamp(12px, calc(14px * (100vw / 390px)), 18px);
  }
}

@layer components {
  .btn-primary {
    @apply bg-primary text-white font-semibold py-3 px-6 rounded-2xl 
           shadow-card transition-all duration-200 
           hover:shadow-lg active:scale-95 
           focus:ring-2 focus:ring-primary focus:ring-opacity-50;
  }

  .btn-secondary {
    @apply bg-white text-gray-700 font-semibold py-3 px-6 rounded-2xl 
           border border-gray-200 shadow-card transition-all duration-200 
           hover:shadow-lg hover:border-gray-300 active:scale-95
           dark:bg-dark-card dark:text-dark-text dark:border-gray-600;
  }

  .card {
    @apply bg-white rounded-2xl shadow-card p-6 
           dark:bg-dark-card dark:shadow-card-dark;
  }

  .progress-bar {
    @apply w-full bg-gray-200 rounded-full h-2 
           dark:bg-gray-700;
  }

  .progress-fill {
    @apply bg-primary h-2 rounded-full transition-all duration-300;
  }

  .question-text {
    @apply text-lg leading-relaxed text-center 
           text-light-text dark:text-dark-text;
  }

  .choice-button {
    @apply w-full p-4 text-left rounded-2xl border-2 
           transition-all duration-200 font-medium
           hover:shadow-md active:scale-95
           focus:ring-2 focus:ring-primary focus:ring-opacity-50;
  }

  .choice-button.unselected {
    @apply bg-white border-gray-200 text-gray-700
           hover:border-gray-300
           dark:bg-dark-card dark:border-gray-600 dark:text-dark-text;
  }

  .choice-button.selected {
    @apply bg-primary border-primary text-white
           shadow-lg transform scale-105;
  }

  .result-card {
    @apply bg-white rounded-2xl shadow-card p-8 max-w-md mx-auto
           dark:bg-dark-card dark:shadow-card-dark;
  }

  .type-nickname {
    @apply text-3xl font-bold text-center mb-4
           text-primary dark:text-primary;
  }

  .type-subtitle {
    @apply text-lg text-center text-gray-600 mb-6
           dark:text-dark-secondary;
  }

  .section-title {
    @apply text-xl font-bold mb-4 text-light-text
           dark:text-dark-text;
  }

  .tip-item {
    @apply flex items-start space-x-3 mb-3;
  }

  .tip-number {
    @apply flex-shrink-0 w-6 h-6 bg-primary text-white 
           rounded-full text-sm font-bold flex items-center justify-center;
  }

  .share-bar {
    @apply fixed bottom-0 left-0 right-0 bg-white border-t 
           border-gray-200 p-4 flex gap-3
           dark:bg-dark-card dark:border-gray-600;
  }

  .toast {
    @apply fixed top-4 left-1/2 transform -translate-x-1/2 
           bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg
           z-50 animate-fade-in;
  }
}

/* 인쇄 및 이미지 캡쳐용 스타일 */
@media print, screen and (max-width: 0) {
  .no-print {
    display: none !important;
  }
}

/* 모바일 최적화 */
@media (max-width: 430px) {
  .card {
    @apply mx-4;
  }
  
  .result-card {
    @apply mx-4 p-6;
  }
  
  .type-nickname {
    @apply text-2xl;
  }
}

/* 스와이프 제스처 비활성화 (네비게이션 우선) */
.quiz-container {
  touch-action: pan-y pinch-zoom;
}

/* 브라우저별 이미지 렌더링 최적화 */
@layer components {
  .image-ratio-fix {
    /* 브라우저별 이미지 비율 통일 */
    object-fit: contain;
    object-position: center;
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
  }
  
  /* Safari 특화 이미지 최적화 */
  .safari-image-fix {
    -webkit-transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    image-rendering: -webkit-optimize-contrast;
  }
  
  /* Chrome 특화 이미지 최적화 */
  .chrome-image-fix {
    image-rendering: crisp-edges;
    image-rendering: pixelated;
  }
  
  /* Firefox 특화 이미지 최적화 */
  .firefox-image-fix {
    image-rendering: auto;
  }
}

/* 긴 화면 비율 디바이스 대응 */
@media (min-height: 900px) and (max-width: 430px) {
  .long-screen-quiz {
    min-height: 100vh;
    min-height: 100dvh; /* 최신 브라우저 */
  }
  
  .long-screen-quiz .question-area {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 0;
  }
  
  .long-screen-quiz .button-area {
    flex-shrink: 0;
    padding: 1rem 0 2rem 0;
  }
}

/* Galaxy Fold 접힌 상태 대응 */
@media (max-width: 320px) and (max-height: 700px) {
  .fold-screen-quiz {
    min-height: 100vh;
  }
  
  .fold-screen-quiz .question-area {
    padding: 1rem 0;
  }
  
  .fold-screen-quiz .button-area {
    padding: 0.5rem 0 1rem 0;
  }
  
  .fold-screen-quiz .answer-button {
    width: 140px;
    height: 150px;
    font-size: 1rem;
  }
}

/* iPhone 14 Pro Max, iPhone 15 Plus 대응 */
@media (min-width: 414px) and (max-width: 430px) and (min-height: 900px) {
  .iphone-large-quiz {
    min-height: 100vh;
    min-height: 100dvh;
  }
  
  .iphone-large-quiz .question-area {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem 0;
  }
}

/* Safari 주소창 대응 */
@layer base {
  /* Safari 주소창 고려한 뷰포트 높이 */
  .safari-viewport {
    height: 100vh;
    height: -webkit-fill-available; /* Safari 전용 */
    height: 100dvh; /* 최신 브라우저 */
  }
  
  /* 하단 Safe Area 대응 */
  .safari-bottom-safe {
    padding-bottom: env(safe-area-inset-bottom);
    padding-bottom: max(env(safe-area-inset-bottom), 1rem);
  }
  
  /* 동적 뷰포트 높이 */
  .safari-dynamic-height {
    height: calc(var(--vh, 1vh) * 100);
    min-height: calc(var(--vh, 1vh) * 100);
    overflow-x: hidden;
    position: relative;
  }
  
  /* Safari에서 위로 스크롤 시 주황색 배경 방지 */
  .safari-dynamic-height::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg);
    z-index: -1;
    pointer-events: none;
  }
  
  /* Safari에서 주황색 그림자 완전히 숨기기 - 강화된 선택자 */
  .safari-dynamic-height .bg-\[var\(--brand\)\]\/30,
  .safari-dynamic-height [class*="bg-[var(--brand)]/30"],
  .safari-dynamic-height *[style*="zIndex: -2"],
  .safari-dynamic-height .orange-shadow {
    z-index: -2 !important;
    position: relative !important;
  }
  
  /* Safari에서 주황색 그림자 완전히 숨기기 - 더 강력한 방법 */
  .safari-dynamic-height::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg);
    z-index: -1.5;
    pointer-events: none;
  }
}

@layer components {
  /* 하단 고정 버튼 - Safari 대응 */
  .bottom-fixed-safari {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem;
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
    background: white;
    border-top: 1px solid #e5e5e5;
    z-index: 50;
  }
  
  /* 메인 콘텐츠 - 하단 버튼 공간 확보 */
  .main-content-safari {
    padding-bottom: 120px; /* 버튼 높이 + 여백 */
    min-height: calc(var(--vh, 1vh) * 100);
  }
  
  /* 인라인 버튼 - 스크롤 가능 */
  .inline-buttons-safari {
    padding: 1rem;
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
    background: white;
    border-top: 1px solid #e5e5e5;
  }
}